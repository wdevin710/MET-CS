{
    "collab_server" : "",
    "contents" : "# Project Functions \n\n### Pre-Process Data & Call Neural Network \n\nForecast.Electric.Demand <- function (Raw_Data) \n{\n  print(\"2. Inputs sent to function: Forecast.Electric.Demand()\")\n  # Extract Time Stemps from Data\n  Num.Data.Points <- dim(Raw_Data)[1]\n  Time.Stamp <- strptime(Raw_Data$DATE,\"%m/%d/%Y %H:%M\")\n  \n  # Select Training Range \n  StartTime <- 1 # which(Time.Stamp==\"2014-03-01 01:00:00 EST\")\n  TrainRange <- StartTime:Num.Data.Points\n  print(paste0(\"Training data start date: \",Time.Stamp[StartTime]))\n  \n  # Extract Hours field from Time.Stamp\n  Hours <- rep(1,length(TrainRange)) # Replace this Line\n  # Insert your code here\n  \n  # Extract Days field from Time.Stamp\n  Day.Number <- rep(1,length(TrainRange)) # Replace this Line\n  # Insert your code here\n  \n  # Modify Hours & Days\n  Hours.Modified <- Hours # Replace this Line\n  Day.Number.Modified <- Day.Number # Replace this Line\n  # Insert your code here\n  print(\"Extracting Hour_of_Day & Day_of_Week fields from the DATE field Time Stamp \")\n  \n  # Choose Data to Process \n  Dependent.Ix <- c(2:4) # Select dependent columns\n  Dependent.Data <- cbind(Hours.Modified, Day.Number.Modified, Raw_Data[TrainRange,Dependent.Ix]); # X ()\n  Independent.Ix <- c(5) # Select Independent columns\n  Independent.Data <- Raw_Data[TrainRange,Independent.Ix]; # Y (Actual Electric Demand )\n  print(\"Dependent data tags: \");  print(names(Dependent.Data))\n  print(\"Independent data tags: \");  print(names(Raw_Data[Independent.Ix]))\n  \n  # Get inputs & targets from the Data \n  inputs <- Dependent.Data # Actual Consumption - used for training\n  targets <- Independent.Data # Expected Consumption (Regression data) used as Tags\n  Percent.To.Test <- 0.30 # Split the input data into train and test\n  print(\"Define NuNet Inputs: \"); print(paste0(\"Percent of input data to test: \", 100*Percent.To.Test, \" %\"))\n  \n  # Train NuNet & Get Predictions\n  print(\"Train NuNet & Get Predictions, please wait... \");\n  Predicted.Electric.Demand <- TrainNuNet(inputs,targets,Percent.To.Test) \n  print(\"NuNet Training finished!\");\n  \n  Output <- list(\"TimeStamp\"=Time.Stamp,\"inputs\"=inputs,\n                 \"targets\"=targets,\n                 Predicted.Electric.Demand=Predicted.Electric.Demand,\n                 Percent.To.Test=Percent.To.Test)\n  \n  return (Output) # Returned object\n  \n}\n\n\nTrainNuNet <- function (inputs,targets,Percent.To.Test) \n{\n  # Normalize the Data \n  if (is.null(dim(inputs))) # Single Column Input\n  {\n    z <- max(inputs, na.rm=TRUE) # find Max in Single Input Column\n    inputs.scale <- z; targets.scale <- max(targets, na.rm=TRUE)\n    inputs.normalized <- inputs/inputs.scale # Normalize Data\n    targets.normalized <- targets/targets.scale # Normalize Data \n  }\n  else # Multi Colum Input\n  {\n    z <- apply(inputs, MARGIN = 2, function(x) max(x, na.rm=TRUE)) # find Max in Each Input Column\n    inputs.scale <- as.vector(z); targets.scale <- max(targets, na.rm=TRUE);\n    inputs.normalized <- sweep(inputs, 2, inputs.scale, `/`) # Normalize Data\n    targets.normalized <- targets/targets.scale # Normalize Data   \n  }\n  \n  \n  # Split the Data into Train and Test\n  patterns <- splitForTrainingAndTest(inputs.normalized, targets.normalized, ratio = Percent.To.Test) \n  set.seed(13);\n  \n  # Train NN to folow Actual \n  # The use of an Elman network (Elman 1990) for time series regression.\n  # model <- elman(patterns$inputsTrain, patterns$targetsTrain,\n  #                size = c(10, 10), learnFuncParams = c(0.1), maxit = 1300,\n  #                inputsTest = patterns$inputsTest, targetsTest = patterns$targetsTest,\n  #                linOut = FALSE)\n  model <- elman(patterns$inputsTrain, patterns$targetsTrain,\n                 size = c(8, 8), learnFuncParams = c(0.1), maxit = 500,\n                 inputsTest = patterns$inputsTest, targetsTest = patterns$targetsTest,\n                 linOut = FALSE)\n  \n  NN.fitted.Train <- model$fitted.values*targets.scale \n  NN.fitted.Test <- model$fittedTestValues*targets.scale \n  \n  Predicted.Electric.Demand <- c(NN.fitted.Train,NN.fitted.Test)\n  \n  result <- list(Predicted.Electric.Demand)\n  \n  return (result) # Returned object\n}\n\n",
    "created" : 1533229112922.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3612789825",
    "id" : "12B997E5",
    "lastKnownWriteTime" : 1533231632,
    "last_content_update" : 1533231632101,
    "path" : "~/My Files/Teachng/2018/Summer/Classroom/Class 9/IoT Code/IIoT Lab/Project Functions.R",
    "project_path" : "Project Functions.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}